<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>English Profiles Manager</title>
    <link rel="stylesheet" href="screen.css" />
    <style>
      /* --- 2026 ADMIN THEME --- */
      :root {
        --primary: #00539b;
        --accent: #00aeef;
        --bg-body: #f4f7f9;
        --text-main: #2b2b2b;
        --card-radius: 12px;
        --danger: #d9534f;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background-color: var(--bg-body);
        color: var(--text-main);
        padding-bottom: 100px;
      }

      .navbar-inverse {
        background: #1a1a1a;
        border: none;
      }

      /* --- LAYOUT --- */
      .editor-container {
        display: flex;
        gap: 30px;
        margin-top: 40px;
      }

      /* --- SIDEBAR --- */
      .sidebar {
        width: 300px;
        flex-shrink: 0;
        background: white;
        border-radius: var(--card-radius);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        height: fit-content;
      }

      .sidebar-header {
        padding: 20px;
        background: #f8fafc;
        border-bottom: 1px solid #eee;
        font-weight: 700;
        color: var(--primary);
      }

      .profile-list {
        max-height: 600px;
        overflow-y: auto;
      }

      .profile-item {
        padding: 15px 20px;
        border-bottom: 1px solid #f4f4f4;
        cursor: pointer;
        transition: background 0.1s;
      }
      .profile-item:hover {
        background-color: #f0f7ff;
      }
      .profile-item.active {
        background-color: #e3f2fd;
        border-left: 4px solid var(--primary);
      }

      .profile-code {
        font-weight: 800;
        font-size: 1.1rem;
        display: block;
        color: var(--primary);
      }
      .profile-label {
        font-size: 0.85rem;
        color: #666;
      }

      /* --- EDITOR PANEL --- */
      .main-editor {
        flex-grow: 1;
        background: white;
        border-radius: var(--card-radius);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        padding: 40px;
        min-height: 600px;
        display: none; /* Hidden until selected */
      }

      .header-row {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      /* --- TEST CARDS --- */
      .test-card {
        background: #fff;
        border: 1px solid #e0e6ed;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        border-left: 4px solid var(--accent);
      }

      .test-title-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .score-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 15px;
        background: #f9fbfd;
        padding: 15px;
        border-radius: 8px;
      }

      .score-input label {
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #777;
        margin-bottom: 5px;
        text-align: center;
      }

      .score-input input {
        text-align: center;
        font-weight: 700;
        color: var(--primary);
      }

      .form-control {
        border-radius: 6px;
        border: 1px solid #ddd;
        padding: 10px;
        box-shadow: none;
      }

      /* --- BUTTONS --- */
      .btn-add-test {
        width: 100%;
        padding: 15px;
        border: 2px dashed #ccc;
        background: transparent;
        border-radius: 8px;
        color: #666;
        font-weight: 600;
        transition: all 0.2s;
      }
      .btn-add-test:hover {
        border-color: var(--accent);
        color: var(--accent);
        background: #f0fbff;
      }

      .btn-delete {
        color: #d9534f;
        background: none;
        border: none;
        font-size: 0.9rem;
        cursor: pointer;
      }
      .btn-delete:hover {
        text-decoration: underline;
      }

      /* Floating Save */
      .floating-save {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
        height: auto;
        border-radius: 50px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        font-size: 1.1rem;
        padding: 15px 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #28a745;
        color: white;
        border: none;
        transition: transform 0.2s;
      }
      .floating-save:hover {
        transform: translateY(-3px);
      }

      #empty-state {
        text-align: center;
        padding-top: 100px;
        color: #999;
      }
      #notification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 2000;
        display: none;
        width: 350px;
      }
    </style>
  </head>
  <body>
    <div id="notification" class="alert alert-success">
      <strong>Success!</strong> Profiles saved. Replace 'english_profiles.json'.
    </div>

    <nav class="navbar navbar-inverse navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="index.html">‚Üê Back to Hub</a>
        </div>
        <p class="navbar-text">English Language Profiles Manager</p>
      </div>
    </nav>

    <div class="container editor-container">
      <div class="sidebar">
        <div class="sidebar-header">
          Profiles
          <button
            class="btn btn-xs btn-primary pull-right"
            onclick="addProfile()"
          >
            + New
          </button>
        </div>
        <div class="profile-list" id="sidebar-list"></div>
      </div>

      <div class="main-editor" id="editor-panel">
        <div class="header-row">
          <div style="width: 120px">
            <label class="text-muted small">Profile ID</label>
            <input
              type="text"
              class="form-control"
              id="field-id"
              placeholder="e.g. 1-d"
            />
          </div>
          <div style="flex-grow: 1">
            <label class="text-muted small">Faculty / Description</label>
            <input
              type="text"
              class="form-control"
              id="field-label"
              placeholder="e.g. School of English"
            />
          </div>
          <div style="display: flex; align-items: flex-end">
            <button class="btn btn-danger" onclick="deleteProfile()">
              Delete Profile
            </button>
          </div>
        </div>

        <h4 style="margin-bottom: 20px; color: var(--primary)">
          Accepted Tests
        </h4>
        <div id="tests-container"></div>

        <button class="btn-add-test" onclick="addTest()">
          <span class="glyphicon glyphicon-plus"></span> Add Another Test (e.g.
          PTE)
        </button>
      </div>

      <div class="main-editor" id="empty-state" style="display: block">
        <span
          class="glyphicon glyphicon-list-alt"
          style="font-size: 4em; margin-bottom: 20px; opacity: 0.3"
        ></span>
        <h2>Select a Profile</h2>
        <p>Choose a profile from the left to edit requirements.</p>
      </div>
    </div>

    <button class="floating-save" onclick="saveJSON()">
      <span class="glyphicon glyphicon-floppy-disk"></span> &nbsp;
      <strong>Save as JSON</strong>
    </button>

    <script>
      let db = [];
      let activeIndex = -1;

      // 1. Load Data
      fetch("english_profiles.json")
        .then((res) => res.json())
        .then((data) => {
          // Sort by ID naturally (1-d, 7-d)
          db = data.sort((a, b) =>
            a.id.localeCompare(b.id, undefined, { numeric: true }),
          );
          renderSidebar();
        })
        .catch((err) => console.error("Error loading JSON", err));

      // 2. Render Sidebar
      function renderSidebar() {
        const list = document.getElementById("sidebar-list");
        list.innerHTML = "";

        db.forEach((p, index) => {
          const div = document.createElement("div");
          div.className = `profile-item ${index === activeIndex ? "active" : ""}`;
          div.innerHTML = `
                    <span class="profile-code">${p.id.toUpperCase()}</span>
                    <span class="profile-label">${p.label}</span>
                `;
          div.onclick = () => loadEditor(index);
          list.appendChild(div);
        });
      }

      // 3. Load Editor
      function loadEditor(index) {
        activeIndex = index;
        const data = db[index];

        document.getElementById("empty-state").style.display = "none";
        document.getElementById("editor-panel").style.display = "block";

        renderSidebar(); // Update active state

        document.getElementById("field-id").value = data.id;
        document.getElementById("field-label").value = data.label;

        renderTests();
      }

      // 4. Render Tests
      function renderTests() {
        const container = document.getElementById("tests-container");
        container.innerHTML = "";

        db[activeIndex].tests.forEach((t, i) => {
          const card = document.createElement("div");
          card.className = "test-card";
          card.innerHTML = `
                    <div class="test-title-row">
                        <input type="text" class="form-control" style="width:60%; font-weight:bold;" 
                            value="${t.name}" placeholder="Test Name" 
                            onchange="updateTest(${i}, 'name', this.value)">
                        
                        <button class="btn-delete" onclick="removeTest(${i})">Remove Test</button>
                    </div>

                    <div class="score-grid">
                        <div class="score-input">
                            <label>Overall</label>
                            <input type="text" class="form-control" value="${t.overall}" onchange="updateTest(${i}, 'overall', this.value)">
                        </div>
                        <div class="score-input">
                            <label>Listening</label>
                            <input type="text" class="form-control" value="${t.listening}" onchange="updateTest(${i}, 'listening', this.value)">
                        </div>
                        <div class="score-input">
                            <label>Reading</label>
                            <input type="text" class="form-control" value="${t.reading}" onchange="updateTest(${i}, 'reading', this.value)">
                        </div>
                        <div class="score-input">
                            <label>Writing</label>
                            <input type="text" class="form-control" value="${t.writing}" onchange="updateTest(${i}, 'writing', this.value)">
                        </div>
                        <div class="score-input">
                            <label>Speaking</label>
                            <input type="text" class="form-control" value="${t.speaking}" onchange="updateTest(${i}, 'speaking', this.value)">
                        </div>
                    </div>
                `;
          container.appendChild(card);
        });
      }

      // 5. Data Handling
      document.getElementById("field-id").addEventListener("input", (e) => {
        db[activeIndex].id = e.target.value;
        renderSidebar(); // Live update
      });

      document.getElementById("field-label").addEventListener("input", (e) => {
        db[activeIndex].label = e.target.value;
        renderSidebar();
      });

      function updateTest(testIndex, field, value) {
        db[activeIndex].tests[testIndex][field] = value;
      }

      function addTest() {
        db[activeIndex].tests.push({
          name: "New Test",
          overall: "",
          listening: "",
          reading: "",
          writing: "",
          speaking: "",
        });
        renderTests();
      }

      function removeTest(index) {
        if (confirm("Remove this test?")) {
          db[activeIndex].tests.splice(index, 1);
          renderTests();
        }
      }

      function addProfile() {
        db.push({
          id: "NEW",
          label: "New Faculty Profile",
          tests: [],
        });
        loadEditor(db.length - 1);
      }

      function deleteProfile() {
        if (confirm("Are you sure you want to delete this entire profile?")) {
          db.splice(activeIndex, 1);
          activeIndex = -1;
          document.getElementById("editor-panel").style.display = "none";
          document.getElementById("empty-state").style.display = "block";
          renderSidebar();
        }
      }

      function saveJSON() {
        const blob = new Blob([JSON.stringify(db, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "english_profiles.json";
        a.click();

        const note = document.getElementById("notification");
        note.style.display = "block";
        setTimeout(() => (note.style.display = "none"), 3000);
      }
    </script>
  </body>
</html>
